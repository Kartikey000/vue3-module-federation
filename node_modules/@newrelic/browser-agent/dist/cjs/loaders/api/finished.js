"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.setupFinishedAPI = setupFinishedAPI;
var _runtime = require("../../common/constants/runtime");
var _handle = require("../../common/event-emitter/handle");
var _console = require("../../common/util/console");
var _constants = require("../../features/metrics/constants");
var _features = require("../features/features");
var _constants2 = require("./constants");
var _sharedHandlers = require("./sharedHandlers");
/**
 * Copyright 2020-2025 New Relic, Inc. All rights reserved.
 * SPDX-License-Identifier: Apache-2.0
 */

function setupFinishedAPI(agent) {
  (0, _sharedHandlers.setupAPI)(_constants2.FINISHED, function (unixTime = Date.now()) {
    const relativeTime = unixTime - _runtime.originTime;
    if (relativeTime < 0) (0, _console.warn)(62, unixTime);
    (0, _handle.handle)(_constants.CUSTOM_METRIC_CHANNEL, [_constants2.FINISHED, {
      time: relativeTime
    }], undefined, _features.FEATURE_NAMES.metrics, agent.ee);
    agent.addToTrace({
      name: _constants2.FINISHED,
      start: unixTime,
      origin: 'nr'
    });
    (0, _handle.handle)(_constants2.prefix + _constants2.ADD_PAGE_ACTION, [relativeTime, _constants2.FINISHED], undefined, _features.FEATURE_NAMES.genericEvents, agent.ee);
  }, agent);
}